
Данная программа предназначена для подготовки отчетов к отправке в гиперграф. Она автоматически создает договор с необходимыми условиями под конкретный тип отчета, привязывает к договору платеж, создает отчет и сопоставляет начисление. Затем производится попытка отправки отчета в СРО.

Для работы программы должен быть установлен python версии 3.8 и библиотека requests

Для запуска нужно запустить файл main.py с ключом соответствующим типу отчета, который требуется создать.

# Пример запуска из командной строки:
```
> python main.py trk
```

# Перечень доступных ключей для создания отчетов:
mp - Мелкая публичка
mpr - Мелкая публичка с признаком "на рейтинг" (без приложенного файла)
mp_event - Мероприятие мелкая публичка
trk - ТРК
avp - АВП
fil - Филармонии
event - Мероприятие
event_f - Мероприятие с бесплатным входом
event_n - Мероприятие с признаком "не охраняется"
all - С этим ключем будут созданы все вышеперечисленные типы отчетов

Также предусмотрен ключ help, чтобы вывести на экран список доступных ключей.

Так же программу можно запустить для выбранного сервера, сейчас доступные сервера это тест, препрод и хотфикс. По умолчанию будет выбран сервер тест, для запуска на препроде или хотфиксе необходимо, перед запуском программы, добавить переменную окружения "preprod" или "hotfix" соответственно.

Для создания договоров используются заранее подготовленные данные (субъекты, объекты, мероприятия, платежи) В случаях перезаполнения базы данных на серверах препрод или хотфикс для работы теста необходимо заного создать требуемые тесту сущности. Для этого нужно, перед созданием отчетов, запустить программу с ключом "create" - после завершения можно будет снова запустить программу уже с ключом для нужного отчета.


# Запуск в unix
```
> git clone git@git.id-network.ru:crm/autotest.git
> make build
> make run
> make run-preprod
> make clean
```

# Запуск в Windows + Docker
```
> git clone git@git.id-network.ru:crm/autotest.git
> docker build -t autotest .
> docker run -it --rm --name autotest autotest
> docker run -it --rm --name autotest --env preprod=true autotest
> docker run -it --rm --name autotest --env hotfix=true autotest
> docker rmi autotest
```

Добавлены тесты для проверки договоров фонмикс.
Нужно запустить файл fonmix.py с одним из следующих ключей:

check - выполнить проверку наличия субъекта. (используется заготовленный субъект)
create14 - выполнить создание договора оферты с существующим субъектом (используется заготовленный субъект)
create14n - выполнить создание договора оферты с новым субъектом
create15 - выполнить создание договора закрытый каталог с существующим субъектом (используется заготовленный субъект)

Тест так же реагирует на переменную окружения, для запуска на разных серверах.
